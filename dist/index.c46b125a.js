let e,t;const l=new G6.Grid,a=document.createElement("input");a.type="text",document.body.appendChild(a),a.addEventListener("input",e=>{!function(e){let t=graph.findAll("node",t=>t.getModel().label===e);graph.highlightNodes(t.map(e=>e.getID()))}(e.target.value)});const i=new G6.Tooltip({offsetX:20,offsetY:20,getContent(e){let t=document.createElement("div");return t.style.width="auto",t.innerHTML=`
<ul>
<li><span class="label">\u{540D}\u{79F0}:</span> <span class="value">${e.item.getModel().label}</span></li>
<li><span class="label">\u{7C7B}\u{578B}:</span> <span class="value">${e.item.getModel().category}</span></li>
</ul>`,t},itemTypes:["node"]}),o=document.getElementById("search-input"),s=document.getElementById("search-button"),r=document.createElement("ul");r.className="candidate-list",document.querySelector(".search-wrapper").appendChild(r),s.addEventListener("click",()=>{let e=o.value,t=d.findAll("node",t=>t.getModel().orilabel.includes(e)||t.getModel().category===e);if(t&&t.length>0){let e=t.length;console.warn(`\u{4E00}\u{5171}\u{627E}\u{5230} ${e} \u{4E2A}\u{8282}\u{70B9}.`),t.forEach(e=>{d.setItemState(e,"focus",!0),d.focusItem(e)})}else alert("没有找到符合条件的节点")}),r.addEventListener("click",e=>{o.value=e.target.innerHTML,console.log(o.value)}),o.addEventListener("input",()=>{let e=o.value,t=d.findAll("node",t=>t.getModel().orilabel.includes(e)||t.getModel().category===e);r.innerHTML="",t&&t.length>0?(t.forEach(e=>{let t=document.createElement("li");t.className="candidate-item",t.innerHTML=e.getModel().orilabel,r.appendChild(t)}),r.style.display="block"):r.style.display="none"}),o.addEventListener("keydown",e=>{if("Enter"===e.key){let e=o.value,t=d.findAll("node",t=>t.getModel().orilabel.includes(e)||t.getModel().category===e);if(t&&t.length>0){let e=t.length;alert(`\u{4E00}\u{5171}\u{627E}\u{5230} ${e} \u{4E2A}\u{8282}\u{70B9}.`),t.forEach(e=>{d.setItemState(e,"focus",!0),d.focusItem(e)})}else alert("没有找到符合条件的节点")}});const{uniqueId:n}=G6.Util;let d=null,c={nodes:[],edges:[]},u={},g={},h=[],f={},p={instance:null},y=[],m=[],b=!1,E=1e3,k=600;const v=G6.Util.getColorSetsBySubjectColors(["#0f63a9","#eb4d4b","rgba(251, 197, 49,1.0)","#91cc75","rgba(156, 136, 255,1.0)","rgba(127, 143, 166,1.0)"],"rgb(43, 47, 51)","dark","#777"),M={node:{style:{fill:"#2B384E"},labelCfg:{style:{fill:"#acaeaf",stroke:"#191b1c"}},stateStyles:{focus:{fill:"#2B384E"},selected:{lineWidth:10,strokeOpacity:.5},activeByLegend:{lineWidth:10,strokeOpacity:.5},inactiveByLegend:{opacity:.5}}},edge:{style:{stroke:"#acaeaf",realEdgeStroke:"#acaeaf",realEdgeOpacity:.2,strokeOpacity:.2},labelCfg:{style:{fill:"#acaeaf",realEdgeStroke:"#acaeaf",realEdgeOpacity:.5,stroke:"#191b1c"}},stateStyles:{focus:{stroke:"#fff"}}}};G6.registerNode("聚合节点",{draw(e,t){let l=2*e.count,a=2*e.count,i=e.style||{},o=e.colorSet||v[0];t.addShape("rect",{attrs:{x:-(.6*l),y:-(.6*a),width:1.2*l,height:1.2*a,fill:o.mainFill,opacity:.8,lineWidth:.5,radius:1.2*(a/2||13)},name:"halo-shape",visible:!1}),t.addShape("rect",{attrs:{x:-(.6*l),y:-(.6*a),width:1.2*l,height:1.2*a,fill:o.mainFill,stroke:"rgba(245, 246, 250,1.0)",lineWidth:3,lineOpacty:.5,radius:1.2*(a/2||13)},name:"stroke-shape",visible:!1});let s=t.addShape("rect",{attrs:{...i,x:-l/2,y:-a/2,width:l,height:a,fill:o.mainFill,opacity:.2,stroke:o.mainStroke,lineWidth:4,cursor:"pointer",radius:a/2||13,lineDash:[12,12]},name:"aggregated-node-keyShape"}),r={};return e.labelCfg&&(r=Object.assign(r,e.labelCfg.style)),t.addShape("text",{attrs:{text:e.label,x:0,y:-10,textAlign:"center",textBaseline:"middle",cursor:"pointer",fontSize:14,fill:"rgba(245, 246, 250,0.8)",fontWeight:600},name:"label-shape",className:"label-shape"}),t.addShape("text",{attrs:{text:`\u{8282}\u{70B9}\u{603B}\u{6570}\u{FF1A}${e.count+431}`,x:0,y:10,textAlign:"center",textBaseline:"middle",cursor:"pointer",fontSize:12,fill:"rgba(220, 221, 225,0.8)",opacity:.85,fontWeight:400},name:"count-shape",className:"count-shape",draggable:!0}),e.new&&t.addShape("circle",{attrs:{x:l/2-3,y:-a/2+3,r:4,fill:"#6DD400",lineWidth:.5,stroke:"#FFFFFF"},name:"typeNode-tag-circle"}),s},setState:(e,t,l)=>{let a=l.get("group");if("layoutEnd"===e&&t){let e=a.find(e=>"text-shape"===e.get("name"));e&&e.set("visible",!0)}else if("hover"===e){if(l.hasState("focus"))return;let e=a.find(e=>"halo-shape"===e.get("name")),i=l.getKeyShape(),o=l.getModel().colorSet||v[0];t?(e&&e.show(),i.attr("fill",o.activeFill)):(e&&e.hide(),i.attr("fill",o.mainFill))}else if("focus"===e){let e=a.find(e=>"stroke-shape"===e.get("name")),i=l.getKeyShape(),o=l.getModel().colorSet||v[0];t?(e&&e.show(),i.attr("fill",o.selectedFill)):(e&&e.hide(),i.attr("fill",o.mainFill))}},update:void 0},"聚合节点"),G6.registerNode("普通节点",{draw(e,t){var l=1.5*e.degree+5;let a=e.style||{},i=e.colorSet||v[0];t.addShape("circle",{attrs:{x:0,y:0,r:l+5,fill:a.fill||i.mainFill||"#2B384E",opacity:.7,lineWidth:0},name:"halo-shape",visible:!1}),t.addShape("circle",{attrs:{x:0,y:0,r:l+5,fill:a.fill||i.mainFill||"#2B384E",stroke:"rgba(245, 246, 250,1.0)",strokeOpacity:.85,lineWidth:2},name:"stroke-shape",visible:!1});let o=t.addShape("circle",{attrs:{...a,x:0,y:0,r:l,fill:i.mainFill,stroke:i.mainStroke,lineWidth:2,cursor:"pointer"},name:"aggregated-node-keyShape"}),s={};if(e.labelCfg&&(s=Object.assign(s,e.labelCfg.style)),e.label){let a=e.label,i={},o=0;e.labelCfg&&(i=Object.assign(i,e.labelCfg.style),o+=e.labelCfg.refY||0);let s=0,r=i.fontSize<8?8:i.fontSize;s=(e.labelLineNum||1)*(r||12),t.addShape("text",{attrs:{text:a,x:0,y:l+o+s+5,textAlign:"center",textBaseLine:"alphabetic",cursor:"pointer",fontSize:r,fill:"#fff",opacity:.85,fontWeight:400,stroke:M.edge.labelCfg.style.stroke},name:"text-shape",className:"text-shape"})}return e.new&&t.addShape("circle",{attrs:{x:l-3,y:-l+3,r:4,fill:"#6DD400",lineWidth:.5,stroke:"#FFFFFF"},name:"typeNode-tag-circle"}),o},setState:(e,t,l)=>{let a=l.get("group");if("layoutEnd"===e&&t){let e=a.find(e=>"text-shape"===e.get("name"));e&&e.set("visible",!0)}else if("hover"===e){if(l.hasState("focus"))return;let e=a.find(e=>"halo-shape"===e.get("name")),i=l.getKeyShape(),o=l.getModel().colorSet||v[0];t?(e&&e.show(),i.attr("fill",o.activeFill)):(e&&e.hide(),i.attr("fill",o.mainFill))}else if("focus"===e){let e=a.find(e=>"stroke-shape"===e.get("name")),i=a.find(e=>"text-shape"===e.get("name")),o=l.getKeyShape(),s=l.getModel().colorSet||v[0];t?(e&&e.show(),o.attr("fill",s.selectedFill),i&&i.attr("fontWeight",800)):(e&&e.hide(),o.attr("fill",s.mainFill),i&&i.attr("fontWeight",400))}},update:void 0},"普通节点"),G6.registerEdge("ClusterEdge",{setState:(e,t,l)=>{let a=l.get("group"),i=l.getModel();if("focus"===e){let e=a.find(e=>"back-line"===e.get("name"));e&&(e.stopAnimate(),e.remove(),e.destroy());let l=a.find(e=>"edge-shape"===e.get("name")),o=i.style.endArrow;if(t){if(l.cfg.animation&&l.stopAnimate(!0),l.attr({strokeOpacity:.6,opacity:.6,stroke:"#fff",endArrow:{...o,stroke:"#fff",fill:"#fff"}}),i.isReal){let{lineWidth:e,path:t,endArrow:i,stroke:o}=l.attr();a.addShape("path",{attrs:{lineWidth:e,path:t,stroke:o,endArrow:i,opacity:.1},name:"back-line"}).toBack();let s=l.getTotalLength();l.animate(e=>{let t=e*s;return{lineDash:[t,s-t]}},{repeat:!0,duration:4e3})}else{let e=0,t=l.attr("lineDash"),a=t[0]+t[1];l.animate(()=>(++e>a&&(e=0),{lineDash:t,lineDashOffset:-e}),{repeat:!0,duration:4e3})}}else{l.stopAnimate();let e="#acaeaf",t=i.isReal?.2:.1;l.attr({stroke:e,strokeOpacity:t,opacity:t,endArrow:{...o,stroke:e,fill:e}})}}}},"quadratic"),G6.registerEdge("NodeEdge",{setState:(e,t,l)=>{let a=l.get("group"),i=l.getModel();if("focus"===e){let e=a.find(e=>"edge-shape"===e.get("name")),l=a.find(e=>"back-line"===e.get("name"));l&&(l.stopAnimate(),l.remove(),l.destroy());let o=i.style.endArrow;if(t){if(e.cfg.animation&&e.stopAnimate(!0),e.attr({strokeOpacity:.6,opacity:.6,stroke:"#fff",endArrow:{...o,stroke:"#fff",fill:"#fff"}}),i.isReal){let{path:t,stroke:l,lineWidth:i}=e.attr();a.addShape("path",{attrs:{path:t,stroke:l,lineWidth:i,opacity:.1},name:"back-line"}).toBack();let o=e.getTotalLength();e.animate(e=>{let t=e*o;return{lineDash:[t,o-t]}},{repeat:!0,duration:4e3})}else{let t=e.attr("lineDash"),l=t[0]+t[1],a=0;e.animate(()=>(++a>l&&(a=0),{lineDash:t,lineDashOffset:-a}),{repeat:!0,duration:4e3})}}else{e.stopAnimate();let t="#acaeaf",l=i.isReal?.2:.1;e.attr({stroke:t,strokeOpacity:l,opacity:l,endArrow:{...o,stroke:t,fill:t}})}}}},"single-edge");const S=e=>function(t,l){let a=t[e];return l[e]-a},x=e=>{e&&(F(e),w(e))},F=e=>{e.findAllByState("node","focus").forEach(t=>{e.setItemState(t,"focus",!1)})},w=e=>{e.findAllByState("edge","focus").forEach(t=>{e.setItemState(t,"focus",!1)})},I=(e,t=5,l="...")=>e?e.length>t?`${e.substr(0,t)}${l}`:e:"",C=(e,t=10)=>e&&e.split("").length>t?`${e.substr(0,t)}...`:e,A=(l,a,i,o,s,r,d=!1)=>{if(!l||0===l.length)return{};let c={},u=-1/0;l.forEach(e=>{e.type=0===e.level?"普通节点":"聚合节点",e.isReal=0===e.level,e.degree=0,e.inDegree=0,e.outDegree=0,c[e.id]&&(console.warn("node exists already!",e.id),e.id=`${e.id}${Math.random()}`),c[e.id]=e,e.count>u&&(u=e.count);let l=f?f[e.id]:void 0;l?(e.x=l.x,e.y=l.y,e.new=!1):(e.new=!d,!t||e.x||e.y||(e.x=t.x+10*Math.cos(Math.random()*Math.PI*2),e.y=t.y+10*Math.sin(Math.random()*Math.PI*2)))});let g=-1/0,h=1/0;a.forEach(e=>{if(e.id?"edge"!==e.id.split("-")[0]&&(e.id=`edge-${e.id}`):e.id=n("edge"),!c[e.source]||!c[e.target]){console.warn("edge source target does not exist",e.source,e.target,e.id);return}let t=c[e.source],l=c[e.target];t&&l||console.warn("source or target is not defined!!!",e,t,l),t.degree++,l.degree++,t.outDegree++,l.inDegree++,e.count>g&&(g=e.count),e.count<h&&(h=e.count)}),l.sort(S("degree"));let p=l[0].degree||1,y=[];l.forEach(e=>{let t=e.count/u,l=0===e.level;e.size=l?(e.degree+2)*2:e.count,e.isReal=l,e.labelCfg={position:"bottom",offset:5,style:{fill:M.node.labelCfg.style.fill,fontSize:6+6*t||12,stroke:M.node.labelCfg.style.stroke,lineWidth:3}},e.degree||y.push(e)});let m=g-h;return a.forEach(e=>{let l=c[e.target],a=(e.count-h)/m*9+1||1;e.size=a;let i=Math.max(a/2+2,3),o=l.size+10,n=`M ${o},0 L ${o+10},-${i} L ${o+10},${i} Z`,d=l.size/2+10;e.source===e.target&&(e.type="loop",n=void 0);let u=c[e.source],g=l.isReal&&u.isReal;e.isReal=g;let f=g?M.edge.style.realEdgeStroke:M.edge.style.stroke,p=g?M.edge.style.realEdgeOpacity:M.edge.style.strokeOpacity,y=Math.max(a,2),b=g?void 0:[y,y];e.style={stroke:f,strokeOpacity:p,cursor:"pointer",lineAppendWidth:Math.max(e.size||5,5),fillOpacity:1,lineDash:b,endArrow:!!n&&{path:n,d:d,fill:f,strokeOpacity:0}},e.labelCfg={autoRotate:!0,style:{stroke:M.edge.labelCfg.style.stroke,fill:M.edge.labelCfg.style.fill,lineWidth:4,fontSize:12,lineAppendWidth:10,opacity:1}},e.orilabel||(e.orilabel=e.label),s||!r?e.label="":e.label=C(e.label,5);let E=u.size/2+20,k=l.size/2+20;u.x&&!l.x&&(l.x=u.x+E*Math.cos(Math.random()*Math.PI*2)),u.y&&!l.y&&(l.y=u.y+E*Math.sin(Math.random()*Math.PI*2)),l.x&&!u.x&&(u.x=l.x+k*Math.cos(Math.random()*Math.PI*2)),l.y&&!u.y&&(u.y=l.y+k*Math.sin(Math.random()*Math.PI*2)),u.x||u.y||!t||(u.x=t.x+30*Math.cos(Math.random()*Math.PI*2),u.y=t.y+30*Math.sin(Math.random()*Math.PI*2)),l.x||l.y||!t||(l.x=t.x+30*Math.cos(Math.random()*Math.PI*2),l.y=t.y+30*Math.sin(Math.random()*Math.PI*2))}),e={x:i-.3*i,y:o-.3*o},y.forEach(t=>{t.x||t.y||(t.x=e.x+30*Math.cos(Math.random()*Math.PI*2),t.y=e.y+30*Math.sin(Math.random()*Math.PI*2))}),G6.Util.processParallelEdges(a,12.5,"ClusterEdge","NodeEdge"),{maxDegree:p,edges:a}},B=(e,t,l)=>{let{linkDistance:a,edgeStrength:i,nodeStrength:o,nodeSpacing:s,preventOverlap:r,nodeSize:n,collideStrength:d,alpha:c,alphaDecay:h,alphaMin:f}=l||{preventOverlap:!0};a||0===a||(a=150),i||0===i||(i=40),o||0===o||(o=200),s||0===s||(s=5);let p={type:"gForce",minMovement:.01,maxIteration:2e3,preventOverlap:r,nodeSize:100,damping:.99,linkDistance:e=>{let t=a,l=u[e.source]||g[e.source],i=u[e.target]||g[e.target];return l.level&&i.level?t=3*a:(l.level||i.level)&&(t=1.5*a),l.level||i.level||(t=.3*a),t},edgeStrength:e=>{let t=u[e.source]||g[e.source],l=u[e.target]||g[e.target];return t.level&&l.level?i:t.level||l.level?2*i:i},nodeStrength:e=>1===e.degree?100:"产业"===e.category?3*o:e.level?15*o:o,nodeSpacing:e=>0===e.degree?2*s:e.level?400:s,onLayoutEnd:()=>{t&&e.getEdges().forEach(e=>{e.orilabel&&e.update({label:C(e.orilabel,5)})})},tick:()=>{e.refreshPositions()}};return n&&(p.nodeSize=n),d&&(p.collideStrength=d),c&&(p.alpha=c),h&&(p.alphaDecay=h),f&&(p.alphaMin=f),p},z=e=>{h.forEach(t=>{e.hideItem(t)})},W=e=>{e.getNodes().forEach(t=>{t.isVisible()||e.showItem(t)}),e.getEdges().forEach(e=>{e.isVisible()||e.showItem(e)}),h=[]},$=(e,t,l,a,i,o,s)=>{if(!t||!e)return;x(e),e.getNodes().forEach(e=>{e.isVisible()||e.show()}),e.getEdges().forEach(e=>{e.isVisible()||e.show()});let r=[],n=[];return n=A(r=t.nodes,t.edges||[],l,a,i,o,s).edges,e.changeData({nodes:r,edges:n}),z(e),e.getNodes().forEach(e=>{e.toFront()}),p.instance.init({nodes:t.nodes,edges:n}),p.instance.minMovement=1e-4,p.instance.getMass=e=>f[e.id]?5:1,p.instance.execute(),{nodes:r,edges:n}},O=(e,t,l,a,i,o)=>{let s=[],r=[],d={},c={};return i.forEach(e=>{d[e.id]=!0}),o.forEach(e=>{c[e.id]=!0}),e.clusters.forEach((e,t)=>{d[e.id]?(s=s.concat(e.nodes),a[e.id].expanded=!0):(s.push(a[e.id]),a[e.id].expanded=!1)}),t.edges.forEach(e=>{let t=d[l[e.source].clusterId],a=d[l[e.target].clusterId];if(t&&a)r.push(e);else if(t){let t=l[e.target].clusterId,a={source:e.source,target:t,id:n("edge"),label:""};r.push(a)}else if(a){let t=l[e.source].clusterId,a={target:e.target,source:t,id:n("edge"),label:""};r.push(a)}}),e.clusterEdges.forEach(e=>{!d[e.source]&&!d[e.target]&&r.push(e)}),{nodes:s,edges:r}},D=(e,t,l,a)=>{for(let i=0;i<l;i++){let o=t[i];if(!a[i]&&e.parentId===o.id){a[i]=!0,D(o,t,l,a);break}}},N=(e,l,a,i)=>{if(t={x:l.x,y:l.y},e>2e3){let e={},t=i.length;D(l,i,t,e);let o=-1;for(let l=0;l<t;l++)if(!e[l]){o=l;break}if(-1!==o){let e,l=i[o];if(2===l.level){let e=!1;for(let a=0;a<t;a++){let t=i[a];if(t.parentId===l.id&&1===t.level){e=!0,l=t,i.splice(a,1);break}}e||i.splice(o,1)}else i.splice(o,1);let s=l.id.split("-");for(let t=0;t<s.length-1;t++){let l=s[t];e=e?`${e}-${l}`:l}let r={id:e,parentId:l.id,level:l.level-1};a.push(r)}}let o={id:l.id,level:l.level,parentId:l.parentId};return i.push(o),d.get("canvas").setCursor("default"),{expandArray:i,collapseArray:a}},L=e=>{let t={},l=e.length;for(let a=0;a<l;a++){let l=e[a].getModel();t[l.id]={x:l.x,y:l.y,level:l.level}}return t},G=()=>{p.instance.stop()},P=e=>{e.on("keydown",e=>{let t=e.key;t&&(b="shift"===t.toLowerCase())}),e.on("keyup",e=>{let t=e.key;t&&"shift"===t.toLowerCase()&&(b=!1)}),e.on("node:mouseenter",t=>{let{item:l}=t,a=l.getModel(),i=a.label;a.oriFontSize=a.labelCfg.style.fontSize,l.update({label:a.orilabel}),a.orilabel=i,e.setItemState(l,"hover",!0),l.toFront()}),e.on("node:mouseleave",t=>{let{item:l}=t,a=l.getModel(),i=a.label;l.update({label:a.orilabel}),a.orilabel=i,e.setItemState(l,"hover",!1)}),e.on("edge:mouseenter",e=>{let{item:t}=e,l=t.getModel(),a=l.label;t.update({label:l.orilabel}),l.orilabel=a,t.toFront(),t.getSource().toFront(),t.getTarget().toFront()}),e.on("edge:mouseleave",e=>{let{item:t}=e,l=t.getModel(),a=l.label;t.update({label:l.orilabel}),l.orilabel=a}),e.on("node:click",t=>{G(),b?w(e):x(e);let{item:l}=t;e.setItemState(l,"focus",!0),b||(l.getEdges().forEach(t=>{e.setItemState(t,"focus",!0)}),l.getNeighbors().filter(e=>0===e.getModel().level).forEach(t=>{e.setItemState(t,"focus",!0)}))}),e.on("edge:click",t=>{G(),b||x(e);let{item:l}=t;e.setItemState(l,"focus",!0)}),e.on("canvas:click",t=>{x(e),console.log(e.getGroup(),e.getGroup().getBBox(),e.getGroup().getCanvasBBox())})},T={产业:0,技术:1,企业:2,专利:3,产品:4,聚合节点:5},j={原材料:"cluster1",组件:"cluster2",整车:"cluster3",市场服务:"cluster4",undefined:"未定义"},R={};for(const e in j)R[j[e]]=e;const _=(e,l,a,i,o,s,r,n)=>{t={x:e.x,y:e.y};let d=H(e,n,l);console.log(d),a.nodes=a.nodes.concat(d.nodes),a.edges=a.edges.concat(d.edges),d.nodes.forEach(e=>{s[e.id]=e});let c=e.clusterId;i.clusters.forEach(e=>{e.id===c&&(e.nodes=e.nodes.concat(d.nodes),e.sumTot+=d.edges.length)}),r[c].count+=d.nodes.length;let u=d.nodes.filter(e=>!o.nodes.some(t=>t.id===e.id)),g=d.edges.filter(e=>!o.edges.some(t=>t.id===e.id));return o.nodes=o.nodes.concat(u),o.edges=o.edges.concat(g),o},H=(e,t=10,l)=>{let a=[],i=[],o=e.clusterId,s=e.id,r=Math.ceil(Math.random()*t);for(let t=0;t<r;t++){let t={id:"专利"===l?generateRandomPatentName():products[Math.floor(Math.random()*products.length)],clusterId:o,level:0,category:l,colorSet:"专利"===l?v[3]:v[4]};a.push(t),a.forEach(e=>{e.orilabel=e.id,e.label=C(e.orilabel,5)});let r=t.id,n={id:`${s}-${r}`,source:s,target:r,label:"技术"===e.category?"相关专利":"主营产品"};i.push(n)}return{nodes:a,edges:i}};Promise.all(["./data/industries.json","./data/enterprises.json","data/tech_words.json","data/industries_to_techwords.json","./data/industries_to_industries.json","./data/industries_to_enterprises.json","data/techwords_to_industries.json"].map(e=>fetch(e).then(e=>e.json()))).then(e=>{let a=e.reduce((e,t)=>(t.nodes&&e.nodes.push(...t.nodes),t.edges&&e.edges.push(...t.edges),e),{nodes:[],edges:[]}),o={industry:0,technology:0,enterprise:0};a.nodes.forEach(e=>{switch(e.category){case"产业":o.industry+=1;break;case"技术":o.technology+=1;break;case"企业":o.enterprise+=1}});let s={nodes:[{id:"indus",label:`\u{4EA7}\u{4E1A}\u{FF1A}${o.industry+48}`,type:"circle",size:20,style:{fill:"#0f63a9",stroke:"#0f63a9",lineWidth:2,opacity:.5}},{id:"technology",label:`\u{6280}\u{672F}\u{FF1A}${o.technology+300}`,type:"circle",size:20,style:{fill:"#eb4d4b",stroke:"#eb4d4b",lineWidth:2,opacity:.5,stoke:"#dff9fb"}},{id:"enterprise",label:`\u{4F01}\u{4E1A}\u{FF1A}${o.enterprise+300}`,type:"circle",size:20,style:{fill:"rgba(251, 197, 49,1.0)",stroke:"rgba(251, 197, 49,1.0)",lineWidth:2,opacity:.5}},{id:"patent",label:"专利：589",type:"circle",size:20,style:{fill:"#91cc75",stroke:"#91cc75",lineWidth:2,opacity:.5}},{id:"product",label:"产品：487",type:"circle",size:20,style:{fill:" rgba(156, 136, 255,1.0)",stroke:"rgba(156, 136, 255,1.0)",lineWidth:2,opacity:.5}}]},r=new G6.Legend({data:s,align:"center",layout:"vertical",position:"right-top",vertiSep:5,horiSep:5,margin:5,offsetX:2,offsetY:1,padding:16,containerStyle:{fill:"rgba(220, 221, 225,0.5)",opacity:.8,lineWidth:1,radius:30},title:"图例",titleConfig:{position:"center",offsetX:5,offsetY:10},filter:{enable:!0,multiple:!0,trigger:"click",graphActiveState:"focus",filterFunctions:{technology:e=>"技术"===e.category,enterprise:e=>"企业"===e.category,patent:e=>"专利"===e.category,indus:e=>"产业"===e.category}}}),b=document.getElementById("container");b.style.backgroundColor="#2b2f33",E=b.scrollWidth-20,k=(b.scrollHeight||600)-10,u={};let M=function(e){let t=new Map;e.nodes.forEach(e=>{let l=e.belongsto;if(!t.has(l)){let e=`cluster${t.size+1}`;t.set(l,{id:e,sumTot:0,nodes:[]})}let a=t.get(l);a.nodes.push({...e,clusterId:a.id}),a.sumTot++});let l=Array.from(t.values()),a=[],i=new Map;return e.edges.forEach(t=>{let l=e.nodes.find(e=>e.id===t.source),a=e.nodes.find(e=>e.id===t.target),o=j[l.belongsto],s=j[a.belongsto],r=`${o}-${s}`,n=`${s}-${o}`;if(i.has(r)){let e=i.get(r);e.count+=1}else if(i.has(n)){let e=i.get(n);e.count+=1}else i.set(r,{source:o,target:s,count:1})}),a.push(...i.values()),{clusters:l,clusterEdges:a}}(a),S={nodes:[],edges:[]};M.clusters.forEach((e,t)=>{e.nodes.forEach(e=>{e.level=0,e.orilabel=e.id,e.label=I(e.orilabel,5,"..."),e.colorSet=v[T[e.category]],u[e.id]=e,e.isExpanded=!1,e.isNeighborShowed=!1});let l={id:e.id,category:"聚合节点",count:e.nodes.length,level:1,orilabel:R[e.id],label:R[e.id],colorSet:v[T["聚合节点"]],idx:t};g[e.id]=l,S.nodes.push(l)}),M.clusterEdges.forEach(e=>{let t={...e,size:Math.log(e.count),label:"",id:n("edge")};t.source===t.target?(t.type="loop",t.loopCfg={dist:20}):t.type="line",S.edges.push(t)}),a.edges.forEach(e=>{e.id=`${e.source}-${e.target}`});let{edges:x}=A((c=S).nodes,c.edges,E,k,!0,!0,!0),F=new G6.Menu({shouldBegin:e=>!!(e.target&&e.target.isCanvas&&e.target.isCanvas())||!!e.item,getContent(e){let{item:t}=e;if(e.target&&e.target.isCanvas&&e.target.isCanvas())return`<ul>
          <li id='show'>\u{663E}\u{793A}\u{6240}\u{6709}\u{9690}\u{85CF}\u{8282}\u{70B9}</li>
          <li id='collapseAll'>\u{6298}\u{53E0}\u{6240}\u{6709}\u{8282}\u{70B9}</li>
        </ul>`;if(!t)return;let l=t.getType(),a=t.getModel();if(l&&a){if("node"!==l)return`<ul>
            <li id='hide'>\u{9690}\u{85CF}\u{8BE5}\u{8FB9}</li>
          </ul>`;{let e=`<ul>
                        
                            <li id='hide'>\u{9690}\u{85CF}\u{8BE5}\u{8282}\u{70B9}</li>
                          </ul>`;return 0!==a.level?e+=`<ul>
                            <li id='expand'>\u{5C55}\u{5F00}\u{76F8}\u{5173}\u{8282}\u{70B9}</li>
                           
                          </ul>`:(e+=`<ul>
                            <li id='collapse'>\u{6536}\u{7F29}\u{8BE5}\u{8282}\u{70B9}</li>
                               
                              </ul>`,"技术"===a.category)?(a.isExpanded?e+=`<ul>
                                  <li id='neighbor-\u{6536}\u{7F29}'>\u{6536}\u{7F29}\u{76F8}\u{5173}\u{4E13}\u{5229}</li>
                                 </ul>`:e+=`<ul>
                                    <li id='neighbor-\u{5C55}\u{5F00}'>\u{5C55}\u{5F00}\u{76F8}\u{5173}\u{4E13}\u{5229}</li>
                                   </ul>`,e):"企业"===a.category?(a.isExpanded?e+=`<ul>
                                <li id='neighbor-\u{6536}\u{7F29}'>\u{6536}\u{7F29}\u{76F8}\u{5173}\u{4EA7}\u{54C1}</li>
                               </ul>`:e+=`<ul>
                                    <li id='neighbor-\u{5C55}\u{5F00}'>\u{5C55}\u{5F00}\u{76F8}\u{5173}\u{4EA7}\u{54C1}</li>
                                   </ul>`,e):`<ul>
                            <li id='collapse'>\u{6536}\u{7F29}\u{8282}\u{70B9}</li>
                            <li id='hide'>\u{9690}\u{85CF}\u{8BE5}\u{8282}\u{70B9}</li>
                          </ul>`}}},handleMenuClick:(e,l)=>{let i;let o=l&&l.getModel(),s=e.id.split("-");switch(s[0]){case"return":d.getNodes().forEach(e=>{e.getModel().id!==o.id&&("技术"===e.getModel().category?d.showItem(e):(d.hideItem(e),h.push(o.id)))});case"hide":d.hideItem(l),h.push(o.id);break;case"expand":let r=N(d.getNodes().length,o,m,y);y=r.expandArray,m=r.collapseArray,i=O(M,a,u,g,y,m);break;case"collapse":let n=g[o.clusterId];t={x:n.x,y:n.y},m.push(n),W(d);for(let e=0;e<y.length;e++)if(y[e].id===o.clusterId){y.splice(e,1);break}i=O(M,a,u,g,y,m);break;case"collapseAll":i=O(M,a,u,g,y=[],m=[]),W(d);break;case"neighbor":let p=l.getNeighbors(),b="技术"===o.category?"专利":"产品";!1===o.isNeighborShowed&&(i=_(o,b,a,M,c,u,g,10)),o.isNeighborShowed=!0,"展开"===s[1]?p.forEach(e=>{"产业"!==e.getModel().category&&d.showItem(e)}):"收缩"===s[1]&&(console.log(p),p.forEach(e=>{"产业"!==e.getModel().category&&(d.hideItem(e),h.push(e.getModel().id))})),d.getNodes().forEach(e=>{e.getModel().level&&e.getModel().id!==o.id&&(d.hideItem(e),h.push(e.getModel().id))}),o.isExpanded=!o.isExpanded;break;case"show":W(d)}i&&(f=L(d.getNodes()),$(d,c=i,E,k,!0,!0,!1))},offsetX:26,offsetY:0,itemTypes:["node","edge","canvas"]}),w=B(d=new G6.Graph({container:"container",width:E,height:k,linkCenter:!0,minZoom:.1,modes:{default:[{type:"drag-canvas",enableOptimize:!0},{type:"zoom-canvas",enableOptimize:!0,optimizeZoom:.01},{type:"scroll-canvas",direction:"both",enableOptimize:!0,zoomKey:"ctrl",scalableRange:-.3},{type:"lasso-select",selectedState:"focus",trigger:"shift"},"drag-node","shortcuts-call"]},plugins:[F,l,i,r]}),!0);w.center=[E/2,k/2],p.instance=new G6.Layout.gForce(w),p.instance.init({nodes:c.nodes,edges:x}),p.instance.execute(),P(d),d.data({nodes:S.nodes,edges:x}),d.render()}),"undefined"!=typeof window&&(window.onresize=()=>{if(!d||d.get("destroyed"))return;let e=document.getElementById("container");e&&d.changeSize(e.scrollWidth,e.scrollHeight-30)});
//# sourceMappingURL=index.c46b125a.js.map
